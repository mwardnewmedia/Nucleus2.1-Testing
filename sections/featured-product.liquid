{%- comment -%}
***************************************************************
PLEASE NOTE: Do not change this file! 
This theme is managed by the Replica app. 
Any manual changes may be automatically overwritten at any time.
3rd PARTY APP DEVELOPERS BEWARE WITH INSTALLS!
Modify at your own peril, a broken website is the likely result.
***************************************************************
{%- endcomment -%}

{%- assign product = all_products[section.settings.featured_product] -%}
{%- assign variant = product.selected_or_first_available_variant -%}

{%- if product == empty -%}
  {%- assign section_onboarding = true -%}
  {%- assign vendor = 'homepage.onboarding.product_vendor' | t -%}
  {%- assign title = 'homepage.onboarding.product_title' | t -%}
  {%- assign compare_at_price = 2999 -%}
  {%- assign price = 1999 -%}
{%- else -%}
  {%- assign section_onboarding = false -%}
  {%- assign vendor = product.vendor -%}
  {%- assign title = product.title -%}
  {%- assign compare_at_price = variant.compare_at_price -%}
  {%- assign price = variant.price -%}
{%- endif -%}

<!-- Load variants for media switching -->
<script>
  window.featuredProductVariants_{{ section.id }} = [
    {% for variant in product.variants %}
    {
        id: {{ variant.id }},
        title: "{{ variant.title | escape }}",
        featured_media_id: {{ variant.featured_media.id | default: 'null' }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];
</script>

{% if section.settings.product_quantity_enable == false %}
  <style>
    .selector-wrapper select, .product-variants select {
      margin-bottom: 13px;
    }
  </style>
{% endif %}


<script>
  $(document).ready(function() {
    // Setup quantity selector functionality for featured product
    $('#ProductSection-{{ section.id }} .pdp-quantity-selector .js--qty-adjuster').on('click', function() {
      var el = $(this);
      var qtySelector = el.siblings('.js--num');
      var qty = parseInt(qtySelector.val()) || 1;
      var qtyMin = 1;
      
      // Add or subtract from the current quantity
      if (el.hasClass('js--add')) {
        qty = qty + 1;
      } else {
        qty = qty <= qtyMin ? qtyMin : qty - 1;
      }
      
      // Update the input's number
      qtySelector.val(qty);
      
      // Trigger change event for form submission
      qtySelector.trigger('change');
    });
    
    // Ensure quantity is always at least 1 for featured product
    $('#ProductSection-{{ section.id }} .pdp-quantity-selector .js--num').on('blur', function() {
      var qty = parseInt($(this).val()) || 1;
      if (qty < 1) {
        $(this).val(1);
      }
    });
    
    // Featured Product Clickable Box Selector Functionality with Media Switching
    $('#ProductSection-{{ section.id }} .variant-selector-boxes .variant-box').on('click', function() {
      var $box = $(this);
      var variantId = $box.data('variant-id');
      var $select = $box.closest('.variant-selector-boxes').find('select');
      
      // Don't allow selection of sold out variants
      if ($box.hasClass('sold-out')) {
        return;
      }
      
      // Update selected state
      $box.siblings('.variant-box').removeClass('selected');
      $box.addClass('selected');
      
      // Update hidden select
      $select.val(variantId).trigger('change');
      
      // Update SKU and UPC display if they exist
      var sku = $box.data('sku');
      var barcode = $box.data('barcode');
      
      if (sku) {
        $('#ProductSection-{{ section.id }} .variant-sku').text(sku);
      }
      if (barcode) {
        $('#ProductSection-{{ section.id }} .variant-barcode').text(barcode);
      }
      
      // Switch media based on variant
      var featuredMediaId = $box.data('featured-media-id');
      if (featuredMediaId) {
        // Find the Alpine.js component and update selectedId
        var $alpineComponent = $('#ProductSection-{{ section.id }}').find('[x-data*="selectedId"]');
        if ($alpineComponent.length > 0) {
          // Trigger Alpine.js update
          $alpineComponent[0].__x.$data.selectedId = featuredMediaId;
        }
      }
    });
    
    // Featured Product Dropdown Selector Functionality with Media Switching
    $('#ProductSection-{{ section.id }} .product-variants-{{ section.id }}').on('change', function() {
      var selectedVariantId = $(this).val();
      var variants = window.featuredProductVariants_{{ section.id }};
      
      if (variants && selectedVariantId) {
        // Find the selected variant
        var selectedVariant = variants.find(function(variant) {
          return variant.id == selectedVariantId;
        });
        
        if (selectedVariant && selectedVariant.featured_media_id) {
          // Find the Alpine.js component and update selectedId
          var $alpineComponent = $('#ProductSection-{{ section.id }}').find('[x-data*="selectedId"]');
          if ($alpineComponent.length > 0) {
            // Trigger Alpine.js update
            $alpineComponent[0].__x.$data.selectedId = selectedVariant.featured_media_id;
          }
        }
      }
    });
  });
</script>
<hr>
<div id="ProductSection-{{ section.id }}" data-section-id="{{ section.id }}" data-section-type="product-template" data-related-enabled="{{ section.settings.product_related_enable }}" data-social-sharing="{{ section.settings.social_sharing }}" data-show-compare-at-price="false" data-stock="false" data-incoming-transfer="false" data-ajax-cart-method="{{ settings.ajax_cart_method }}">

  {% if section.settings.title != blank %}
    <div class="section-header">
      <h2 class="section-header--left h2">{{ section.settings.title | escape }}</h2>
    </div>
  {% endif %}

{% render 'breadcrumb' %}

<hr>

<div class="grid" itemscope itemtype="http://schema.org/Product">
  <meta itemprop="url" content="{{ shop.url }}{{ product.url }}">
  <meta itemprop="image" content="{{ product.featured_image.src | image_url: 'grande' }}">

  <div class="grid-item large--two-fifths">
    <div class="grid">
      <div class="grid-item large--eleven-twelfths text-center">
        {% unless section_onboarding %}
          {% for media in product.media %}
            {% assign first_media_id = product.media.first.id %}
          {% endfor %}
        <div x-data="{ selectedId: {{ first_media_id }} }">    
          {% render 'featured-product-image-selector' %}
        </div>
        {% else %}
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
        {% endunless %}
      </div>
    </div>
  </div>

  <div class="grid-item large--three-fifths">

    <h1 class="h2" itemprop="name">{{ title }}</h1>

    {% unless vendor == 'Hardware-Catalyst' or vendor == "Do It Best" or vendor == shop.name or vendor == "True Value Rental" %} 
      <p class="product-meta" itemprop="brand">{{ vendor }}</p>
    {% endunless %}

    <div class="item-codes">
      {%- assign current_variant = product.selected_or_first_available_variant -%}
      {%- comment -%} SKU Logic {%- endcomment -%}
      {% if current_variant.sku != blank %}
        {% if settings.display_logged_in_customer_skus %}
          {% if customer %}
            <span>SKU: </span><span class="variant-sku">{{ current_variant.sku }}</span>
          {% endif %}
        {% else %}
          {% if section.settings.product_sku_enable %}
            <span>SKU: </span><span class="variant-sku">{{ current_variant.sku }}</span>
          {% endif %}
        {% endif %}
      {% endif %}
      {%- comment -%} UPC Logic {%- endcomment -%}
      {% if settings.display_logged_in_customer_upcs %}
        {% if customer %}
          {% if current_variant.barcode != blank %}
            <span>UPC: </span><span class="variant-barcode">{{ current_variant.barcode }}</span>
          {% endif %}
        {% endif %}
      {% else %}
        {% if section.settings.product_upc_enable %}
          {% if current_variant.barcode != blank %}
            <span>UPC: </span><span class="variant-barcode">{{ current_variant.barcode }}</span>
          {% endif %}
        {% endif %}
      {% endif %}
    </div>

    <!-- Move Available variant quantity messaging to the top -->
    {% assign curr_variant = product.selected_or_first_available_variant %}
    {% assign qty = curr_variant.inventory_quantity %}

    <div id="variantQuantity-{{ section.id }}" class="variant-quantity">
      {% if section.settings.product_quantity_message and section.settings.house_hasson_catalog == false %}
        {% render 'svg-definitions', icon: 'stock-icon' %}
        <span id="variantQuantity-{{ section.id }}__message">
        Available Inventory: {{ qty }}
        </span>
      {% endif %}
      
      {% if section.settings.product_quantity_message and section.settings.house_hasson_catalog %}
        {% render 'svg-definitions', icon: 'stock-icon' %} 
        <span id="variantQuantity-{{ section.id }}__message">
        Available Inventory: 
          {% if qty == 0 %}
            Out of Stock
          {% elsif qty >= 10 and qty < 20 %}
            Low Stock
          {% elsif qty >= 20 %}
            In Stock
          {% else %}
            {{ qty }}
          {% endif %}
        </span>
      {% endif %}
    </div>
    <!-- end -->

    <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">

      {% assign variant = product.selected_or_first_available_variant %}

      {% unless settings.hide_price or section.settings.hide_price %}
      <meta itemprop="priceCurrency" content="{{ cart.currency.iso_code }}">
      <meta itemprop="price" content="{{ price | divided_by: 100.00 }}">
      
      <ul class="inline-list product-meta" data-price>
        <li>
          <span id="productPrice-{{ section.id }}" class="h1">
            {% render 'price', price: price %}
          </span>
          {% render 'product-unit-price', variant: variant %}
        </li>
        {% if compare_at_price > price and section.settings.product_savings %}
        <li>
          <span id="comparePrice-{{ section.id }}" class="sale-tag large">
            {% render 'price-sale' %}
          </span>
        </li>
        {% endif %}
      </ul>

      {%- if shop.taxes_included or shop.shipping_policy.body != blank -%}
        <div class="product__policies rte">
          {%- if shop.taxes_included -%}
            {{ 'products.general.include_taxes' | t }}
          {%- endif -%}
          {%- if shop.shipping_policy.body != blank -%}
            {{ 'products.general.shipping_policy_html' | t: link: shop.shipping_policy.url }}
          {%- endif -%}
        </div>
      {%- endif -%}
      {% endunless %}

      <hr id="variantBreak" class="hr--clear hr--small">

      <link itemprop="availability" href="http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}">

      {% if section_onboarding %}
        <div class="add-to-cart">
          <button type="submit" name="add" id="addToCart-{{ section.id }}" class="btn btn--add-to-cart" disabled="disabled">
            <span class="icon icon-cart"></span>
            <span id="addToCartText-{{ section.id }}">
              {{ 'products.product.sold_out' | t }}
            </span>
          </button>
        </div>
      {% else %}
        {%- assign form_class = 'addToCartForm' -%}
        {% if section.settings.enable_payment_button %}
          {%- assign form_class = form_class | append: ' addToCartForm--payment-button' -%}
        {% endif %}

        {%- assign form_id = 'addToCartForm-' | append: section.id -%}

      {% form 'product', product, data-productid: product.id, class:form_class, id:form_id, data-product-form: '' %}
          {% unless section.settings.hide_variant_selector %}
            {% assign variant_count = product.variants | size  %} 
            {% unless variant_count >= 1 and product.variants.first.title == "Default Title" %}
              {% if section.settings.hide_add_to_cart %}
                <label>Options</label>
              {% else %}
                <label>Select</label>
              {% endif %}
            {% endunless %}
          {% if section.settings.enable_clickable_boxes %}
            {% assign has_only_default_title = false %}
            {% if product.variants.size == 1 and product.variants.first.title == "Default Title" %}
              {% assign has_only_default_title = true %}
            {% endif %}
            
            {% unless has_only_default_title %}
              <!-- Hide selector wrappers when using box selectors -->
              <style>
                .selector-wrapper { display: none !important; }
              </style>
              <!-- Box Selector -->
              <div class="variant-selector-boxes" data-product-id="{{ product.id }}" data-section-id="{{ section.id }}">
                {% for variant in product.variants %}
                  {% assign media_id = '' %}
                  {% for media in product.media %}
                    {% if media.id == variant.featured_media.id %}
                      {% assign media_id = media.id %}
                      {% break %}
                    {% endif %}
                  {% endfor %}
                  <div class="variant-box {% if variant == product.selected_or_first_available_variant %}selected{% endif %} {% unless variant.available %}sold-out{% endunless %}" 
                       data-variant-id="{{ variant.id }}" 
                       data-sku="{{ variant.sku }}" 
                       data-barcode="{{ variant.barcode }}"
                       data-featured-media-id="{{ media_id }}"
                       data-available="{{ variant.available }}">
                    <span class="variant-box-text">{{ variant.title }}</span>
                  </div>
                {% endfor %}
                <!-- Hidden select for form submission -->
                <select name="id" data-productid="{{ product.id }}" id="productSelect-{{ section.id }}" class="product-variant-selector product-variants-{{ section.id }}" style="display: none;">
                  {% for variant in product.variants %}
                    {% if variant.available %}
                      <option {% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %} data-sku="{{ variant.sku }}" value="{{ variant.id }}">{{ variant.title }}</option>
                    {% else %}
                      <option disabled="disabled">
                        {{ variant.title }} - {{ 'products.product.sold_out' | t }}
                      </option>
                    {% endif %}
                  {% endfor %}
                </select>
              </div>
            {% else %}
              <!-- Hidden select for form submission when only Default Title variant exists -->
              <select name="id" data-productid="{{ product.id }}" id="productSelect-{{ section.id }}" class="product-variant-selector product-variants-{{ section.id }}" style="display: none;">
                {% for variant in product.variants %}
                  {% if variant.available %}
                    <option {% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %} data-sku="{{ variant.sku }}" value="{{ variant.id }}">{{ variant.title }}</option>
                  {% else %}
                    <option disabled="disabled">
                      {{ variant.title }} - {{ 'products.product.sold_out' | t }}
                    </option>
                  {% endif %}
                {% endfor %}
              </select>
            {% endunless %}
          {% else %}
            <!-- Dropdown Selector (Default) -->
            <select name="id" data-productid="{{ product.id }}" id="productSelect-{{ section.id }}" class="product-variants product-variants-{{ section.id }}">
              {% for variant in product.variants %}
                {% if variant.available %}
                  <option {% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %} data-sku="{{ variant.sku }}" value="{{ variant.id }}">{{ variant.title }} - {{ price | money_with_currency }}</option>
                {% else %}
                  <option disabled="disabled">
                    {{ variant.title }} - {{ 'products.product.sold_out' | t }}
                  </option>
                {% endif %}
              {% endfor %}
            </select>
          {% endif %}
          {% endunless %}

          {% if section.settings.product_quantity_enable %}
            <div {% if section.settings.hide_add_to_cart %}style="display: none;"{% endif %} class="pdp-quantity-selector">
              <span class="quantity-selector-wrapper">
                <label class="quantity-selector quantity-selector-{{ section.id }}" for="quantity">{{ 'products.product.quantity' | t }}</label>
                <div class="js-qty">
                  <input type="text" class="js--num" value="1" min="1" data-id="quantity" aria-label="quantity" pattern="[0-9]*" name="quantity" id="quantity">
                  <span class="js--qty-adjuster js--add" data-id="quantity" data-qty="1">+</span>
                  <span class="js--qty-adjuster js--minus" data-id="quantity" data-qty="-1">-</span>
                </div>
              </span>
            </div>
          {% endif %}

          <div class="payment-buttons">
            <button style="{% if section.settings.hide_add_to_cart %}display:none;{% endif %}" type="submit" name="add" id="addToCart-{{ section.id }}" class="btn btn--add-to-cart{% if section.settings.enable_payment_button %} btn--secondary-accent{% endif %}"{% unless variant.available %} disabled="disabled"{% endunless %}>
              <span class="icon icon-cart"></span>
              <span id="addToCartText-{{ section.id }}">
                {% if variant.available %}
                  {{ 'products.product.add_to_cart' | t }}
                {% else %}
                  {{ 'products.product.sold_out' | t }}
                {% endif %}
              </span>
            </button>

            {% if section.settings.enable_payment_button %}
              {{ form | payment_button }}
            {% endif %}
          </div>
        {% endform %}

        <a class="full-details text-link"{% unless section_onboarding %} href="{{ product.url }}?variant={{ variant.id }}"{% endunless %}>
          <h5>{{ 'products.product.full_details' | t }} &#x2192;</h5>
        </a>
      {% endif %}
    </div>

    {% if section.settings.social_sharing_products %}
      {% render 'social-sharing' %}
    {% endif %}

  </div>
</div>

{% unless product == empty %}
  <script type="application/json" id="ProductJson-{{ section.id }}">
    {{ product | json }}
  </script>
{% endunless %}
</div>

<style>
  /* Featured Product Specific Styles - Scoped to prevent conflicts */
  #ProductSection-{{ section.id }} .featured-product__image-wrapper img {
    position: relative!important;
    max-height: 100%!important;
    width:initial!important;
  }
  #ProductSection-{{ section.id }} .featured-product__image-wrapper {
    overflow:initial!important;
    margin-bottom:20px!important;
    border:1px solid #eaeaea;
    border-radius:5px;
    padding:20px;
  }
  #ProductSection-{{ section.id }} .featured-product__image-wrapper img {
    max-height: 400px !important;
  }
  #ProductSection-{{ section.id }} .featured-product-video-overlay {
    position: absolute;
    bottom: 0;
    top: 0;
    background: rgb(0, 0, 0);
    background: rgba(0, 0, 0, 0.5);
    color: #f1f1f1;
    width: 100%;
    height: 100%;
    transition: .5s ease;
    color: white;
    font-size: 20px;
    display: flex;
    text-align: center;
    align-items: center;
    justify-content: center;
  }
  #ProductSection-{{ section.id }} .featured-product-video-overlay svg {
    width:50px;
    height:50px;
    background: rgba(256,256,256,.5);
    border-radius: 100%;
  }
</style>



{% schema %}
{
  "name": {
    "da": "Fremhævet produkt",
    "de": "Vorgestelltes Produkt",
    "en": "Featured product",
    "es": "Producto destacado",
    "fi": "Esittelyssä oleva tuote",
    "fr": "Produit vedette",
    "hi": "विशेष रुप से प्रदर्शित उत्पाद",
    "it": "Prodotto in primo piano",
    "ja": "おすすめ商品",
    "ko": "특별 상품",
    "nb": "Utvalgt produkt",
    "nl": "Uitgelicht product",
    "pt-BR": "Produto em destaque",
    "pt-PT": "Produto em destaque",
    "sv": "Utvald produkt",
    "th": "สินค้าที่แนะนำ",
    "zh-CN": "特色产品",
    "zh-TW": "精選產品"
  },
  "class": "product-template-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Featured Product"
    },
    {
      "type": "product",
      "id": "featured_product",
      "label": {
        "da": "Produkt",
        "de": "Produkte",
        "en": "Product",
        "es": "Producto",
        "fi": "Tuote",
        "fr": "Produit",
        "hi": "उत्पाद",
        "it": "Prodotto",
        "ja": "商品",
        "ko": "제품",
        "nb": "Produkt",
        "nl": "Product",
        "pt-BR": "Produto",
        "pt-PT": "Produto",
        "sv": "Produkt",
        "th": "สินค้า",
        "zh-CN": "产品",
        "zh-TW": "產品"
      }
    },
    {
      "type": "checkbox",
      "id": "product_quantity_enable",
      "label": "Show quantity selector",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "product_sku_enable",
      "label": "Show product sku",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "product_upc_enable",
      "label": "Show product upc",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "product_quantity_message",
      "label": "Show in/out of stock message",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "house_hasson_catalog",
      "label": "Use House Hasson Inventory Tracker",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_clickable_boxes",
      "label": "Enable Clickable Box Option Selector",
      "default": false,
      "info": "Replace the dropdown with clickable boxes for product variant selection"
    },
    {
      "type": "checkbox",
      "id": "hide_variant_selector",
      "label": "Hide option selector",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "product_savings",
      "label": "Show Savings",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "hide_price",
      "label": "Hide price",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "hide_add_to_cart",
      "label": "Hide add to cart button",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_payment_button",
      "label": "Show Buy It Now Button",
      "info": "Each customer will see their preferred payment method from those available on your store, such as PayPal or Apple Pay. [Learn more](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "social_sharing_products",
      "label": "Show social sharing buttons",
      "default": true,
      "info": "Edit social accounts in General settings"
    }
  ],
  "presets": [
    {
      "name": {
        "da": "Fremhævet produkt",
        "de": "Vorgestelltes Produkt",
        "en": "Featured product",
        "es": "Producto destacado",
        "fi": "Esittelyssä oleva tuote",
        "fr": "Produit vedette",
        "hi": "विशेष रुप से प्रदर्शित उत्पाद",
        "it": "Prodotto in primo piano",
        "ja": "おすすめ商品",
        "ko": "특별 상품",
        "nb": "Utvalgt produkt",
        "nl": "Uitgelicht product",
        "pt-BR": "Produto em destaque",
        "pt-PT": "Produto em destaque",
        "sv": "Utvald produkt",
        "th": "สินค้าที่แนะนำ",
        "zh-CN": "特色产品",
        "zh-TW": "精選產品"
      },
      "category": {
        "da": "Produkt",
        "de": "Produkte",
        "en": "Product",
        "es": "Producto",
        "fi": "Tuote",
        "fr": "Produit",
        "hi": "उत्पाद",
        "it": "Prodotto",
        "ja": "商品",
        "ko": "제품",
        "nb": "Produkt",
        "nl": "Product",
        "pt-BR": "Produto",
        "pt-PT": "Produto",
        "sv": "Produkt",
        "th": "สินค้า",
        "zh-CN": "产品",
        "zh-TW": "產品"
      }
    }
  ]
}
{% endschema %}

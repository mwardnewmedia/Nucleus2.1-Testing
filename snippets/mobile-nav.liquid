<div id="mobileNavHeader">
    <div class="display-table-cell">
    <button class="menu-toggle mobileNavBar-link" aria-controls="navBar" aria-expanded="true">
        <svg aria-label="close menu" style="height:25px;" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
  </div>
  <div class="display-table-cell">
    
    {% unless section.settings.hide_shopping_links %}
    <a href="{{ routes.cart_url }}" class="cart-toggle mobileNavBar-link">
      <span class="icon icon-cart"></span>
      <span class="sr-only">Cart</span><span class="cart-count {% if cart.item_count == 0 %}hidden-count{% endif %}">{{ cart.item_count }}</span>
    </a>
    {% endunless %}
    
  </div>
</div>

<ul class="mobile-nav" id="MobileNav">

  {% if shop.customer_accounts_enabled and section.settings.hide_customer_login == false %}
  	  <li>
    	<a href="{{ routes.account_url }}"><span class="fa fa-user" aria-hidden="true" style="margin-right: 8px;"></span>My Account</a>
  	  </li>
  {% endif %}
  {% for link in linklists[section.settings.menu].links %}
    {% if link.links != blank %}
      {% assign parent_index = forloop.index %}
      
      {% comment %} Check if this is a megamenu item {% endcomment %}
      {% if link.title == section.settings.catalyst_megamenu %}
        {% comment %} Mobile Category Dropdown (Catalyst Megamenu) {% endcomment %}
        <li
          class="mobile-nav--has-dropdown {% if link.active %}mobile-nav--active{% endif %}"
          aria-haspopup="true">
          <a
            href="{{ link.url }}"
            class="mobile-nav--link"
            data-meganav-type="parent"
            {% unless request.page_type == 'index' %}{% if link.active %}aria-current="page"{% endif %}{% endunless%}>
              {{ link.title | escape }}
          </a>
          <button class="icon icon-arrow-down mobile-nav--button"
            aria-expanded="false"
            aria-label="{{ link.title | escape }} {{ 'layout.navigation.mobile_menu' | t }}">
          </button>
          <ul
            id="MenuParent-{{ parent_index }}"
            class="mobile-nav--dropdown"
            data-meganav-dropdown>
            <li>
              <a href="{{ routes.collections_url }}/" class="mobile-nav--link" data-meganav-type="child">
                Shop all categories
              </a>
            </li>
            {% for collection in collections %} 
              {% if section.settings.only_catalyst_categories %}
                {% comment %} Only show specific catalyst categories {% endcomment %}
                {% if collection.title == "Automotive" or collection.title == "Building Materials" or collection.title == "Clothing & Apparel" or collection.title == "Electrical" or collection.title == "Farm" or collection.title == "Food & Snacks" or collection.title == "Heating & Cooling" or collection.title == "Hardware" or collection.title == "Home & Cleaning" or collection.title == "Kitchen & Bath" or collection.title contains "Lawn" or collection.title contains "Lighting" or collection.title == "Live Plants" or collection.title == "Lumber" or collection.title == "Pet" or collection.title == "Sporting Goods" or collection.title == "Outdoor Living & Patio" or collection.title == "Paint & Supplies" or collection.title == "Plumbing" or collection.title == "Seasonal & Holiday" or collection.title contains "Small Appliances & Electronics" or collection.title == "Storage & Organization" or collection.title == "Tools" or collection.title == "Dog" or collection.title == "Cat" or collection.title == "Small Animal" or collection.title == "Fish" or collection.title == "Reptile" or collection.title == "Bird" %}
                  {% unless collection.all_products_count == 0 %}
                    <li{% if collection.url.active %} class="mobile-nav--active"{% endif %}>
                      <a
                        href="{{ collection.url }}"
                        class="mobile-nav--link"
                        data-meganav-type="child">
                          {{ collection.title | escape }}
                      </a>
                    </li>
                  {% endunless %}
                {% endif %}
              {% else %}
                {% comment %} Show all collections {% endcomment %}
                {% unless collection.all_products_count == 0 %}
                  <li{% if collection.url.active %} class="mobile-nav--active"{% endif %}>
                    <a
                      href="{{ collection.url }}"
                      class="mobile-nav--link"
                      data-meganav-type="child">
                        {{ collection.title | escape }}
                    </a>
                  </li>
                {% endunless %}
              {% endif %}
            {% endfor %}
          </ul>
        </li>
      {% elsif link.title == section.settings.rental_dropdown_menu %}
        {% comment %} Mobile Rental Dropdown {% endcomment %}
        {% assign rental_collection_count = 0 %}
        {% for collection in collections %}
          {% assign is_rental_collection = false %}
          {% if collection.metafields.newmediaretailer.for_app == 'rental' %}
            {% assign is_rental_collection = true %}
          {% else %}
            {% for product in collection.products limit: 1 %}
              {% if product.tags contains 'Rental' %}
                {% assign is_rental_collection = true %}
                {% break %}
              {% endif %}
            {% endfor %}
          {% endif %}
          
          {% if is_rental_collection and collection.title != 'Rentals' and collection.all_products_count > 0 %}
            {% assign rental_collection_count = rental_collection_count | plus: 1 %}
          {% endif %}
        {% endfor %}
        
        <li
          class="mobile-nav--has-dropdown {% if link.active %}mobile-nav--active{% endif %}"
          aria-haspopup="true">
          <a
            href="{{ link.url }}"
            class="mobile-nav--link"
            data-meganav-type="parent"
            {% unless request.page_type == 'index' %}{% if link.active %}aria-current="page"{% endif %}{% endunless%}>
              {{ link.title | escape }}
          </a>
          <button class="icon icon-arrow-down mobile-nav--button"
            aria-expanded="false"
            aria-label="{{ link.title | escape }} {{ 'layout.navigation.mobile_menu' | t }}">
          </button>
          <ul
            id="MenuRental"
            class="mobile-nav--dropdown"
            data-meganav-dropdown>
            {% if rental_collection_count > 0 %}
              <li>
                <a href="{{ routes.collections_url }}/rentals" class="mobile-nav--link" data-meganav-type="child">
                  View all rentals
                </a>
              </li>
            {% endif %}
            {% for collection in collections %}
              {% assign is_rental_collection = false %}
              {% if collection.metafields.newmediaretailer.for_app == 'rental' %}
                {% assign is_rental_collection = true %}
              {% else %}
                {% for product in collection.products limit: 1 %}
                  {% if product.tags contains 'Rental' %}
                    {% assign is_rental_collection = true %}
                    {% break %}
                  {% endif %}
                {% endfor %}
              {% endif %}
              
              {% if is_rental_collection and collection.title != 'Rentals' and collection.all_products_count > 0 %}
                <li{% if collection.url == request.page_type %} class="mobile-nav--active"{% endif %}>
                  <a
                    href="{{ collection.url }}"
                    class="mobile-nav--link"
                    data-meganav-type="child">
                      {{ collection.title | escape }}
                  </a>
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </li>
      {% elsif link.title == section.settings.secondary_megamenu %}
        {% comment %} Mobile Secondary Dropdown {% endcomment %}
        <li
          class="mobile-nav--has-dropdown {% if link.active %}mobile-nav--active{% endif %}"
          aria-haspopup="true">
          <a
            href="{{ link.url }}"
            class="mobile-nav--link"
            data-meganav-type="parent"
            {% unless request.page_type == 'index' %}{% if link.active %}aria-current="page"{% endif %}{% endunless%}>
              {{ link.title | escape }}
          </a>
          <button class="icon icon-arrow-down mobile-nav--button"
            aria-expanded="false"
            aria-label="{{ link.title | escape }} {{ 'layout.navigation.mobile_menu' | t }}">
          </button>
          <ul
            id="MenuParent-{{ parent_index }}"
            class="mobile-nav--dropdown"
            data-meganav-dropdown>
            {% for childlink in link.links %}
              <li{% if childlink.active %} class="mobile-nav--active"{% endif %}>
                <a
                  href="{{ childlink.url }}"
                  class="mobile-nav--link"
                  data-meganav-type="child">
                    {{ childlink.title | escape }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </li>
      {% elsif link.title == section.settings.tertiary_megamenu %}
        {% comment %} Mobile Tertiary Dropdown {% endcomment %}
        <li
          class="mobile-nav--has-dropdown {% if link.active %}mobile-nav--active{% endif %}"
          aria-haspopup="true">
          <a
            href="{{ link.url }}"
            class="mobile-nav--link"
            data-meganav-type="parent"
            {% unless request.page_type == 'index' %}{% if link.active %}aria-current="page"{% endif %}{% endunless%}>
              {{ link.title | escape }}
          </a>
          <button class="icon icon-arrow-down mobile-nav--button"
            aria-expanded="false"
            aria-label="{{ link.title | escape }} {{ 'layout.navigation.mobile_menu' | t }}">
          </button>
          <ul
            id="MenuParent-{{ parent_index }}"
            class="mobile-nav--dropdown"
            data-meganav-dropdown>
            {% for childlink in link.links %}
              <li{% if childlink.active %} class="mobile-nav--active"{% endif %}>
                <a
                  href="{{ childlink.url }}"
                  class="mobile-nav--link"
                  data-meganav-type="child">
                    {{ childlink.title | escape }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </li>
      {% else %}
        {% comment %} Standard dropdown menu {% endcomment %}
        <li
          class="mobile-nav--has-dropdown {% if link.active %}mobile-nav--active{% endif %}"
          aria-haspopup="true">
          <a
            href="{{ link.url }}"
            class="mobile-nav--link"
            data-meganav-type="parent"
            {% unless request.page_type == 'index' %}{% if link.active %}aria-current="page"{% endif %}{% endunless%}>
              {{ link.title | escape }}
          </a>
          <button class="icon icon-arrow-down mobile-nav--button"
            aria-expanded="false"
            aria-label="{{link.title | escape }} {{ 'layout.navigation.mobile_menu' | t }}">
          </button>
          <ul
            id="MenuParent-{{ parent_index }}"
            class="mobile-nav--dropdown {% if link.levels == 2 %}mobile-nav--has-grandchildren{% endif %}"
            data-meganav-dropdown>
            {% for childlink in link.links %}
              {% if childlink.links != blank %}
              {% assign child_index = forloop.index %}
                <li
                  class="mobile-nav--has-dropdown mobile-nav--has-dropdown-grandchild {% if childlink.active %}mobile-nav--active{% endif %}"
                  aria-haspopup="true">
                  <a
                    href="{{ childlink.url }}"
                    class="mobile-nav--link"
                    data-meganav-type="parent"
                    {% unless request.page_type == 'index' %}{% if childlink.active %}aria-current="page"{% endif %}{% endunless%}>
                      {{ childlink.title | escape }}
                  </a>
                  <button class="icon icon-arrow-down mobile-nav--button"
                    aria-expanded="false"
                    aria-label="{{ childlink.title | escape }} {{ 'layout.navigation.mobile_menu' | t }}">
                  </button>
                  <ul
                    id="MenuChildren-{{ parent_index }}-{{ child_index }}"
                    class="mobile-nav--dropdown-grandchild"
                    data-meganav-dropdown>
                    {% for grandchildlink in childlink.links %}
                      <li{% if grandchildlink.active %} class="mobile-nav--active"{% endif %}>
                        <a
                          href="{{ grandchildlink.url }}"
                          class="mobile-nav--link"
                          data-meganav-type="child"
                          {% unless request.page_type == 'index' %}{% if grandchildlink.active %}aria-current="page"{% endif %}{% endunless %}>
                            {{ grandchildlink.title | escape }}
                          </a>
                      </li>
                    {% endfor %}
                  </ul>
                </li>
              {% else %}
                <li{% if childlink.active %} class="mobile-nav--active"{% endif %}>
                  <a
                    href="{{ childlink.url }}"
                    class="mobile-nav--link"
                    data-meganav-type="child"
                    {% if childlink.active %}aria-current="page"{% endif %}>
                      {{ childlink.title | escape }}
                  </a>
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </li>
      {% endif %}
    {% else %}
      <li{% if link.active %} class="mobile-nav--active"{% endif %}>
        <a
          href="{{ link.url }}"
          class="mobile-nav--link"
          data-meganav-type="child"
          {% unless request.page_type == 'index' %}{% if link.active %}aria-current="page"{% endif %}{% endunless%}>
            {{ link.title | escape }}
        </a>
      </li>
    {% endif %}
  {% endfor %}

  {% if shop.customer_accounts_enabled and section.settings.hide_customer_login == false %}
    {% if customer %}
      <li class="customer-navlink large--hide"><a href="{{ routes.account_url }}">{{ 'layout.customer.view_account' | t }}</a></li>
      <li class="customer-navlink large--hide">{{ 'layout.customer.log_out' | t | customer_logout_link }}</li>
    {% else %}
      <li class="customer-navlink large--hide">{{ 'layout.customer.sign_in' | t | customer_login_link }}</li>
      <li class="customer-navlink large--hide">{{ 'layout.customer.create_account' | t | customer_register_link }}</li>
    {% endif %}
  {% endif %}

  <!-- Contact Information Section -->
  {% if section.settings.show_contact_bar %}
    <li class="mobile-nav--contact-section">
        <div class="mobile-nav--contact-icons" style="text-align: center; padding: 15px 0; display: flex; justify-content: center; align-items: center; flex-wrap: wrap; width: 100%;">
          {% if section.settings.multi_locations %}
            <!-- Multiple locations enabled - show only Contact Us link -->
            {% if section.settings.multi_location_link != blank %}
              <a href="{{ section.settings.multi_location_link | escape }}" class="mobile-nav--contact-icon-link" style="display: inline-block; margin: 0 15px; text-decoration: none; padding: 0;">
                <i class="fa-solid fa-location-dot mobile-nav--contact-icon" aria-hidden="true" style="font-size: 20px; color: inherit;"></i>
              </a>
            {% endif %}
          {% else %}
            <!-- Single location - show individual contact methods -->
            {% if section.settings.show_phone and section.settings.header_phone != blank %}
              <a href="tel:{{ section.settings.header_phone }}" class="mobile-nav--contact-icon-link" aria-label="Call us"  style="display: inline-block; margin: 0 15px; text-decoration: none; padding: 0;">
                <i class="fa-solid fa-phone mobile-nav--contact-icon" aria-hidden="true" style="font-size: 20px; color: inherit;"></i>
              </a>
            {% endif %}
            
            {% if section.settings.show_email and section.settings.header_email != blank %}
              <a href="mailto:{{ section.settings.header_email }}" class="mobile-nav--contact-icon-link" aria-label="Email us"  style="display: inline-block; margin: 0 15px; text-decoration: none; padding: 0;">
                <i class="fa-solid fa-envelope mobile-nav--contact-icon" aria-hidden="true" style="font-size: 20px; color: inherit;"></i>
              </a>
            {% endif %}
            
            {% if section.settings.show_locations and section.settings.header_locations != blank %}
              <a href="{{ section.settings.header_locations }}" class="mobile-nav--contact-icon-link" aria-label="View locations" style="display: inline-block; margin: 0 15px; text-decoration: none; padding: 0;">
                <i class="fa-solid fa-location-dot mobile-nav--contact-icon" aria-hidden="true" style="font-size: 20px; color: inherit;"></i>
              </a>
            {% endif %}
          {% endif %}
        </div>
    </li>
  {% endif %}
</ul>